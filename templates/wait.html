{% extends "base.html" %}
{% block title %}Running - {% endblock %}

{% block content %}
  {% include "messages.html" with messages=messages %}
  <h1>Calculating, please wait.</h1>
  <p>This page will refresh itself automatically. You can save url of this page,
  for example as a bookmark, and check results later using the same address.</p>
  <div class="progress">
    <div class="progress-bar progress-bar-striped active"
         id="progressbar"
         role="progressbar"
         aria-valuenow="{{ progress }}"
         aria-valuemin="0"
         aria-valuemax="100"
         style="width: {{ progress }}%">
      <span class="sr-only" id="progressbar-text">{{ progress }}% Complete</span>
    </div>
  </div>
  <script type="text/javascript">
    var url = "/biogaz/get_status/{{ sample_id }}/{{ type_of_analysis }}";

    function progress(value)
    {
      $('#progressbar').css('width', value+'%').attr('aria-valuenow', value);
      $('#progressbar-text').text(value + '% complete')
    }

    function update_status()
    {
      $.getJSON(url, function(data)
      {
        value = data.status;
        progress(value);
        if(value == 100)
        {
          location.reload();
        }
      });
    }

    $(document).ready(function()
    {
      setInterval(update_status, 5000);
    });
  </script>
{% endblock %}
